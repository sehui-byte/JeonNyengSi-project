<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jns.myinfo.dao.MyinfoDAO">

	<!-- 내가 쓴 레시피 조회하기 -->
	<select id="myRecipeList" parameterType="mvo" resultType="rbvo">
	
		SELECT 
			* 
		FROM
			RECIPE_BOARD A
		WHERE A.MNO = #{mno, jdbcType=VARCHAR}
		AND A.RB_DELETEYN = 'Y'
		<if test="startdate!=null and startdate!='' and enddate!=null and enddate!=''">
		<![CDATA[AND TO_CHAR(A.RB_INSERTDATE , 'YYYY-MM-DD') >= TO_CHAR(TO_DATE(#{startdate, jdbcType=VARCHAR}), 'YYYY-MM-DD')]]>
		<![CDATA[AND TO_CHAR(A.RB_INSERTDATE , 'YYYY-MM-DD') <= TO_CHAR(TO_DATE(#{enddate, jdbcType=VARCHAR}), 'YYYY-MM-DD')]]>
		</if>
		<if test="keyfilter=='key1'">
			<![CDATA[AND A.RCP_NM  LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
		</if>
		<if test="keyfilter=='key2'">
			<![CDATA[AND A.RCP_PARTS_DTLS   LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
		</if>
		<if test="keyfilter=='key3'">
			<![CDATA[AND A.RCP_NM  LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
			<![CDATA[AND A.RCP_PARTS_DTLS   LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
		</if>
		ORDER BY 1
	</select>
	
	<!--  내 레시피 삭제하기 -->
	<update id="myRecipeDelete" parameterType="rbvo">
		UPDATE RECIPE_BOARD
		SET
			RB_DELETEYN  = 'N'
		WHERE RBNO  = #{rbno, jdbcType=VARCHAR}
	</update>	
	
	<!--  내 Q&A 리스트 조회하기 -->
	<select id="myQnAList" parameterType="mvo" resultType="bvo">
	
		SELECT
			*
		FROM
			BOARD A
		WHERE MNO = #{mno, jdbcType=VARCHAR}
		AND A.BTYPE = 'Q'
		AND A.BDELETEYN = 'Y'
		<if test="startdate!=null and startdate!='' and enddate!=null and enddate!=''">
		<![CDATA[AND TO_CHAR(A.BINSERTDATE, 'YYYY-MM-DD') >= TO_CHAR(TO_DATE(#{startdate, jdbcType=VARCHAR}), 'YYYY-MM-DD')]]>
		<![CDATA[AND TO_CHAR(A.BINSERTDATE, 'YYYY-MM-DD') <= TO_CHAR(TO_DATE(#{enddate, jdbcType=VARCHAR}), 'YYYY-MM-DD')]]>
		</if>
		<if test="keyfilter=='key1'">
			<![CDATA[AND A.BTITLE LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
		</if>
		<if test="keyfilter=='key2'">
			<![CDATA[AND A.BCONTENT LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
		</if>
		<if test="keyfilter=='key3'">
			<![CDATA[AND A.BTITLE LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
			<![CDATA[AND A.BCONTENT LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
		</if>
		ORDER BY 1
	</select>
	
	<!--  내 Q&A 리스트 삭제하기 -->
	<update id="myQnADelete" parameterType="mvo">
		UPDATE BOARD
		SET
			BDELETEYN = 'N'
		WHERE
			BTYPE = 'Q'
		AND BNO = #{bno, jdbcType=VARCHAR}
	</update>
	
	
	<!-- 내가 추천한 레시피 조회하기 // API 레시피-->
	<select id="myFavRecipeList1" parameterType="mvo" resultType="rvo">

	SELECT 
		*
	FROM
		FAVORITES A, RECIPE B
	WHERE
		A.MNO = #{mno, jdbcType=VARCHAR}
	AND
		A.RCP_SEQ = B.RCP_SEQ
	<if test="startdate!=null and startdate!='' and enddate!=null and enddate!=''">
	<![CDATA[AND TO_CHAR(A.FINSERTDATE , 'YYYY-MM-DD') >= TO_CHAR(TO_DATE(#{startdate, jdbcType=VARCHAR}), 'YYYY-MM-DD')]]>
	<![CDATA[AND TO_CHAR(A.FINSERTDATE , 'YYYY-MM-DD') <= TO_CHAR(TO_DATE(#{enddate, jdbcType=VARCHAR}), 'YYYY-MM-DD')]]>
	</if>
	<if test="keyfilter=='key1'">
		<![CDATA[AND B.RCP_NM  LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
	</if>
	<if test="keyfilter=='key2'">
		<![CDATA[AND B.RCP_PARTS_DTLS   LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
	</if>
	<if test="keyfilter=='key3'">
		<![CDATA[AND B.RCP_NM  LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
		<![CDATA[AND B.RCP_PARTS_DTLS   LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
	</if>
	ORDER BY 1
	</select>

	<!-- 내가 추천한 레시피 조회하기 // 회원 레시피-->
	<select id="myFavRecipeList2" parameterType="mvo" resultType="rbvo">

	SELECT 
		B.*
	FROM FAVORITES A, RECIPE_BOARD B
	WHERE
		A.MNO = #{mno, jdbcType=VARCHAR}
	AND
		A.RBNO = B.RBNO
	<if test="startdate!=null and startdate!='' and enddate!=null and enddate!=''">
	<![CDATA[AND TO_CHAR(A.FINSERTDATE , 'YYYY-MM-DD') >= TO_CHAR(TO_DATE(#{startdate, jdbcType=VARCHAR}), 'YYYY-MM-DD')]]>
	<![CDATA[AND TO_CHAR(A.FINSERTDATE , 'YYYY-MM-DD') <= TO_CHAR(TO_DATE(#{enddate, jdbcType=VARCHAR}), 'YYYY-MM-DD')]]>
	</if>
	<if test="keyfilter=='key1'">
		<![CDATA[AND B.RCP_NM  LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
	</if>
	<if test="keyfilter=='key2'">
		<![CDATA[AND B.RCP_PARTS_DTLS   LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
	</if>
	<if test="keyfilter=='key3'">
		<![CDATA[AND B.RCP_NM  LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
		<![CDATA[AND B.RCP_PARTS_DTLS   LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
	</if>
	ORDER BY 1
	</select>
	
	<select id="myRankUpdateCheckCount" parameterType="mvo" resultType="java.lang.Integer">
		SELECT
			NVL(COUNT(*), 0)
		FROM
			RECIPE_BOARD A
		WHERE A.MNO = #{mno, jdbcType=VARCHAR}
		AND A.RB_DELETEYN = 'Y'
	</select>	
	
	<select id="myRankUpdateCheckHits" parameterType="mvo" resultType="java.lang.Integer">
		SELECT
			NVL(SUM(A.HITS), 0)
		FROM
			RECIPE_BOARD A
		WHERE A.MNO = #{mno, jdbcType=VARCHAR}
		AND A.RB_DELETEYN = 'Y'
	</select>	
	
	<update id="myRankUpdate" parameterType="mvo">
		UPDATE MEMBER A
			A.MLEVEL = 'C'
		WHERE
			A.MNO = #{mno, jdbcType=VARCHAR}
		AND
			A.MDELETEYN = 'Y'
	</update>
	
	
	
</mapper>