<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jns.myinfo.dao.MyinfoDAO">

	<select id="myinfoSelect" parameterType="mvo" resultType="mvo">
		SELECT
			*
		FROM
			MEMBER A
		WHERE
			A.MNO = #{mno, jdbcType=VARCHAR}
	</select>

	<!-- 내가 쓴 레시피 조회하기 -->
	<select id="myRecipeList" parameterType="mvo" resultType="rbvo">
	
		SELECT 
			* 
		FROM
			RECIPE_BOARD A
		WHERE A.MNO = #{mno, jdbcType=VARCHAR}
		AND A.RB_DELETEYN = 'Y'
		<if test="startdate!=null and startdate!='' and enddate!=null and enddate!=''">
		<![CDATA[AND TO_CHAR(A.RB_INSERTDATE , 'YYYY-MM-DD') >= TO_CHAR(TO_DATE(#{startdate, jdbcType=VARCHAR}), 'YYYY-MM-DD')]]>
		<![CDATA[AND TO_CHAR(A.RB_INSERTDATE , 'YYYY-MM-DD') <= TO_CHAR(TO_DATE(#{enddate, jdbcType=VARCHAR}), 'YYYY-MM-DD')]]>
		</if>
		<if test="keyfilter=='key1'">
			<![CDATA[AND A.RCP_NM  LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
		</if>
		<if test="keyfilter=='key2'">
			<![CDATA[AND A.RCP_PARTS_DTLS   LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
		</if>
		<if test="keyfilter=='key3'">
			<![CDATA[AND A.RCP_NM  LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
			<![CDATA[AND A.RCP_PARTS_DTLS   LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
		</if>
		ORDER BY 1
	</select>
	
	<!--  내 레시피 삭제하기 -->
	<update id="myRecipeDelete" parameterType="rbvo">
		UPDATE RECIPE_BOARD
		SET
			RB_DELETEYN  = 'N'
		WHERE RBNO  = #{rbno, jdbcType=VARCHAR}
	</update>	
	
	<!--  내 Q&A 리스트 조회하기 -->
	<select id="myQnAList" parameterType="mvo" resultType="bvo">
	
		SELECT
			*
		FROM
			BOARD A
		WHERE MNO = #{mno, jdbcType=VARCHAR}
		AND A.BTYPE = 'Q'
		AND A.BDELETEYN = 'Y'
		<if test="startdate!=null and startdate!='' and enddate!=null and enddate!=''">
		<![CDATA[AND TO_CHAR(A.BINSERTDATE, 'YYYY-MM-DD') >= TO_CHAR(TO_DATE(#{startdate, jdbcType=VARCHAR}), 'YYYY-MM-DD')]]>
		<![CDATA[AND TO_CHAR(A.BINSERTDATE, 'YYYY-MM-DD') <= TO_CHAR(TO_DATE(#{enddate, jdbcType=VARCHAR}), 'YYYY-MM-DD')]]>
		</if>
		<if test="keyfilter=='key1'">
			<![CDATA[AND A.BTITLE LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
		</if>
		<if test="keyfilter=='key2'">
			<![CDATA[AND A.BCONTENT LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
		</if>
		<if test="keyfilter=='key3'">
			<![CDATA[AND A.BTITLE LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
			<![CDATA[AND A.BCONTENT LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
		</if>
		ORDER BY 1
	</select>
	
	<!--  내 Q&A 리스트 삭제하기 -->
	<update id="myQnADelete" parameterType="mvo">
		UPDATE BOARD
		SET
			BDELETEYN = 'N'
		WHERE
			BTYPE = 'Q'
		AND BNO = #{bno, jdbcType=VARCHAR}
	</update>
	
	
	<!-- 내가 추천한 레시피 조회하기 // API 레시피-->
	<select id="myFavRecipeList1" parameterType="mvo" resultType="rvo">

	SELECT 
		*
	FROM
		FAVORITES A, RECIPE B
	WHERE
		A.MNO = #{mno, jdbcType=VARCHAR}
	AND
		A.RCP_SEQ = B.RCP_SEQ
	<if test="startdate!=null and startdate!='' and enddate!=null and enddate!=''">
	<![CDATA[AND TO_CHAR(A.FINSERTDATE , 'YYYY-MM-DD') >= TO_CHAR(TO_DATE(#{startdate, jdbcType=VARCHAR}), 'YYYY-MM-DD')]]>
	<![CDATA[AND TO_CHAR(A.FINSERTDATE , 'YYYY-MM-DD') <= TO_CHAR(TO_DATE(#{enddate, jdbcType=VARCHAR}), 'YYYY-MM-DD')]]>
	</if>
	<if test="keyfilter=='key1'">
		<![CDATA[AND B.RCP_NM  LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
	</if>
	<if test="keyfilter=='key2'">
		<![CDATA[AND B.RCP_PARTS_DTLS   LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
	</if>
	<if test="keyfilter=='key3'">
		<![CDATA[AND B.RCP_NM  LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
		<![CDATA[AND B.RCP_PARTS_DTLS   LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
	</if>
	ORDER BY 1
	</select>

	<!-- 내가 추천한 레시피 조회하기 // 회원 레시피-->
	<select id="myFavRecipeList2" parameterType="mvo" resultType="rbvo">

	SELECT 
		B.*
	FROM FAVORITES A, RECIPE_BOARD B
	WHERE
		A.MNO = #{mno, jdbcType=VARCHAR}
	AND
		A.RBNO = B.RBNO
	<if test="startdate!=null and startdate!='' and enddate!=null and enddate!=''">
	<![CDATA[AND TO_CHAR(A.FINSERTDATE , 'YYYY-MM-DD') >= TO_CHAR(TO_DATE(#{startdate, jdbcType=VARCHAR}), 'YYYY-MM-DD')]]>
	<![CDATA[AND TO_CHAR(A.FINSERTDATE , 'YYYY-MM-DD') <= TO_CHAR(TO_DATE(#{enddate, jdbcType=VARCHAR}), 'YYYY-MM-DD')]]>
	</if>
	<if test="keyfilter=='key1'">
		<![CDATA[AND B.RCP_NM  LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
	</if>
	<if test="keyfilter=='key2'">
		<![CDATA[AND B.RCP_PARTS_DTLS   LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
	</if>
	<if test="keyfilter=='key3'">
		<![CDATA[AND B.RCP_NM  LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
		<![CDATA[AND B.RCP_PARTS_DTLS   LIKE '%' || #{keyword, jdbcType=VARCHAR} || '%']]>
	</if>
	ORDER BY 1
	</select>
	
	<select id="myLevelUpdateCheckCount" parameterType="mvo" resultType="java.lang.Integer">
		SELECT
			COUNT(*)
		FROM
			RECIPE_BOARD A
		WHERE A.MNO = #{mno, jdbcType=VARCHAR}
		AND A.RB_DELETEYN = 'Y'
	</select>	
	
	<select id="myLevelUpdateCheckHits" parameterType="mvo" resultType="java.lang.Integer">
		SELECT
			SUM(A.HITS)
		FROM
			RECIPE_BOARD A
		WHERE A.MNO = #{mno, jdbcType=VARCHAR}
		AND A.RB_DELETEYN = 'Y'
	</select>	
	
	<update id="myLevelUpdate" parameterType="mvo">
		UPDATE MEMBER A
		SET
			A.MLEVEL = 'C'
		WHERE
			A.MNO = #{mno, jdbcType=VARCHAR}
		AND
			A.MLEVEL = 'U'
		AND
			A.MDELETEYN = 'Y'
	</update>
	
	<!-- 패스워드 수정 체크 -->
	<select id="myPWUpdateCheck" parameterType="mvo" resultType="mvo">
	
		SELECT 
			* 
		FROM
			MEMBER
		WHERE
			mid = #{mid, jdbcType=VARCHAR}
		AND
			MDELETEYN = 'Y'
	
	</select>
	
	<!--  패스워드 수정 로직 -->
	<update id="myPWUpdate" parameterType="mvo">
		UPDATE MEMBER
		SET
			MPW = #{mpw, jdbcType=VARCHAR}
		WHERE
			MID = #{mid, jdbcType=VARCHAR}	
	</update>

	<select id="myRecipeListPage" parameterType="rbvo" resultType="rbvo">
		SELECT
			*
		FROM
			(SELECT		
					A.RBNO,
					A.MNO,
					A.RCP_NM,
					A.VIEWS,
					A.HITS,
					A.RCP_WAY2,
					A.RCP_PAT2,
					A.HASH_TAG,
					A.MAIN_IMG,
					A.RCP_PARTS_DTLS,
					A.MANUAL01,
					A.MANUAL_IMG01,
					A.MANUAL02,
					A.MANUAL_IMG02,
					A.MANUAL03,
					A.MANUAL_IMG03,
					A.MANUAL04,
					A.MANUAL_IMG04,
					A.MANUAL05,
					A.MANUAL_IMG05,
					A.MANUAL06,
					A.MANUAL_IMG06,
					A.MANUAL07,
					A.MANUAL_IMG07,
					A.MANUAL08,
					A.MANUAL_IMG08,
					A.MANUAL09,
					A.MANUAL_IMG09,
					A.MANUAL10,
					A.MANUAL_IMG10,
					A.MANUAL11,
					A.MANUAL_IMG11,
					A.MANUAL12,
					A.MANUAL_IMG12,
					A.MANUAL13,
					A.MANUAL_IMG13,
					A.MANUAL14,
					A.MANUAL_IMG14,
					A.MANUAL15,
					A.MANUAL_IMG15,
					A.MANUAL16,
					A.MANUAL_IMG16,
					A.MANUAL17,
					A.MANUAL_IMG17,
					A.MANUAL18,
					A.MANUAL_IMG18,
					A.MANUAL19,
					A.MANUAL_IMG19,
					A.MANUAL20,
					A.MANUAL_IMG20,
					A.RB_INSERTDATE,
					A.RB_UPDATEDATE,
					A.RB_DELETEYN,
					CEIL(ROW_NUMBER() OVER(ORDER BY A.RBNO DESC) / 10) PAGENO,
					COUNT(A.RBNO) OVER() AS TOTALCOUNT
		FROM 	RECIPE_BOARD A)
		WHERE
			PAGENO = #{curPage, jdbcType=VARCHAR}
		AND
			mno= #{mno, jdbcType=VARCHAR}
	
	</select>	
	
	
</mapper>